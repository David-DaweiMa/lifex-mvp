# 网页端注册测试指导

## 🎯 测试目标

验证完整的用户注册流程，包括：
- 前端注册页面
- 后端注册API
- 数据库触发器
- 用户配置文件创建
- 用户配额设置
- 前端登录验证

## 📋 测试前准备

### 1. 环境准备
- ✅ 确保开发服务器已启动：`npm run dev`
- ✅ 确保数据库触发器已执行：`fix-database-triggers.sql`
- ✅ 确保环境变量已配置

### 2. 测试工具
- 浏览器（Chrome/Firefox/Safari）
- 开发者工具（F12）
- 网络监控工具

## 🧪 测试步骤

### 步骤1: 启动开发服务器

```bash
npm run dev
```

访问：http://localhost:3000

### 步骤2: 访问注册页面

1. 在浏览器中访问：http://localhost:3000/auth/register
2. 检查页面是否正常加载
3. 检查注册表单是否完整

**预期结果**：
- ✅ 注册页面正常显示
- ✅ 表单字段完整（邮箱、密码、用户名、全名、用户类型）
- ✅ 表单验证正常工作

### 步骤3: 测试不同用户类型注册

#### 3.1 测试免费用户注册

**测试数据**：
- 邮箱：`test-free-2024@example.com`
- 密码：`TestPassword123!`
- 用户名：`testfree`
- 全名：`Test Free User`
- 用户类型：`free`

**操作步骤**：
1. 填写注册表单
2. 选择用户类型为"免费用户"
3. 点击注册按钮
4. 观察注册结果

**预期结果**：
- ✅ 注册成功
- ✅ 跳转到登录页面或成功页面
- ✅ 收到确认邮件（如果配置了邮件服务）

#### 3.2 测试普通用户注册

**测试数据**：
- 邮箱：`test-customer-2024@example.com`
- 密码：`TestPassword123!`
- 用户名：`testcustomer`
- 全名：`Test Customer User`
- 用户类型：`customer`

**预期结果**：
- ✅ 注册成功
- ✅ 用户类型正确设置

#### 3.3 测试高级用户注册

**测试数据**：
- 邮箱：`test-premium-2024@example.com`
- 密码：`TestPassword123!`
- 用户名：`testpremium`
- 全名：`Test Premium User`
- 用户类型：`premium`

**预期结果**：
- ✅ 注册成功
- ✅ 高级用户配额正确设置

### 步骤4: 验证数据库记录

在Supabase Dashboard中检查：

#### 4.1 检查用户配置文件

```sql
-- 检查用户配置文件是否创建
SELECT * FROM public.user_profiles 
WHERE email LIKE '%test-%@example.com'
ORDER BY created_at DESC;
```

**预期结果**：
- ✅ 用户配置文件已创建
- ✅ 用户类型正确
- ✅ 邮箱验证状态正确

#### 4.2 检查用户配额

```sql
-- 检查用户配额是否设置
SELECT u.email, u.user_type, q.quota_type, q.current_usage, q.max_limit
FROM public.user_profiles u
JOIN public.user_quotas q ON u.id = q.user_id
WHERE u.email LIKE '%test-%@example.com'
ORDER BY u.created_at DESC, q.quota_type;
```

**预期配额**：
- **免费用户**：Chat 20/日, Trending 10/月, Ads 2/月
- **普通用户**：Chat 100/日, Trending 50/月, Ads 10/月
- **高级用户**：Chat 500/日, Trending 200/月, Ads 50/月

#### 4.3 检查触发器日志

```sql
-- 检查触发器执行日志
SELECT u.email, t.trigger_name, t.status, t.execution_time, t.error_message
FROM public.user_profiles u
JOIN public.trigger_logs t ON u.id = t.user_id
WHERE u.email LIKE '%test-%@example.com'
ORDER BY t.execution_time DESC;
```

**预期结果**：
- ✅ 触发器执行成功
- ✅ 无错误信息

### 步骤5: 测试登录功能

#### 5.1 使用注册的账号登录

1. 访问登录页面：http://localhost:3000/auth/login
2. 使用刚才注册的邮箱和密码登录
3. 检查登录是否成功

**预期结果**：
- ✅ 登录成功
- ✅ 跳转到主页面
- ✅ 用户信息正确显示

#### 5.2 验证用户状态

1. 检查用户是否已登录
2. 检查用户类型是否正确
3. 检查配额信息是否正确显示

### 步骤6: 测试配额功能

#### 6.1 测试AI聊天配额

1. 访问AI聊天功能
2. 发送几条消息
3. 检查配额使用情况

**预期结果**：
- ✅ 配额正确扣减
- ✅ 达到限制时正确提示

#### 6.2 测试其他功能配额

1. 测试趋势分析功能
2. 测试广告功能
3. 检查配额限制

### 步骤7: 测试错误情况

#### 7.1 测试重复注册

1. 使用已注册的邮箱再次注册
2. 检查错误提示

**预期结果**：
- ✅ 显示邮箱已存在错误
- ✅ 阻止重复注册

#### 7.2 测试无效数据

1. 使用无效邮箱格式
2. 使用弱密码
3. 检查表单验证

**预期结果**：
- ✅ 表单验证正常工作
- ✅ 显示适当的错误信息

## 🔍 调试技巧

### 1. 浏览器开发者工具

**Network标签**：
- 监控注册API调用
- 检查请求和响应
- 查看错误信息

**Console标签**：
- 查看JavaScript错误
- 检查前端日志

### 2. Supabase Dashboard

**Logs页面**：
- 查看API调用日志
- 检查错误信息

**Database页面**：
- 实时查看数据变化
- 执行SQL查询

### 3. 常见问题排查

**注册失败**：
1. 检查网络连接
2. 检查环境变量
3. 查看浏览器控制台错误
4. 检查Supabase日志

**触发器不工作**：
1. 确认触发器已执行
2. 检查触发器日志
3. 验证RLS策略

**配额不正确**：
1. 检查用户类型设置
2. 验证配额配置
3. 查看配额表数据

## 📊 测试检查清单

### 前端测试
- [ ] 注册页面正常加载
- [ ] 表单验证正常工作
- [ ] 不同用户类型选择正常
- [ ] 注册成功/失败提示正确
- [ ] 登录功能正常
- [ ] 用户信息正确显示

### 后端测试
- [ ] 注册API正常响应
- [ ] 数据验证正确
- [ ] 错误处理完善
- [ ] 邮件发送正常（如果配置）

### 数据库测试
- [ ] 用户配置文件创建
- [ ] 用户配额正确设置
- [ ] 触发器执行成功
- [ ] 触发器日志记录
- [ ] 数据一致性

### 功能测试
- [ ] 配额限制正常工作
- [ ] 用户权限正确
- [ ] 会话管理正常
- [ ] 错误恢复机制

## 🎯 成功标准

✅ **所有测试步骤都成功执行**
✅ **不同用户类型都能正确注册**
✅ **配额系统正常工作**
✅ **前端界面响应正常**
✅ **数据库记录完整准确**
✅ **错误处理机制完善**

## 📝 测试报告

完成测试后，请记录：

1. **测试时间**：开始和结束时间
2. **测试环境**：浏览器版本、操作系统
3. **测试结果**：通过/失败的测试项
4. **发现的问题**：详细描述和截图
5. **建议改进**：功能优化建议

## 🆘 获取帮助

如果遇到问题：

1. 查看浏览器控制台错误
2. 检查Supabase Dashboard日志
3. 参考故障排除部分
4. 查看测试结果报告
5. 联系技术支持
